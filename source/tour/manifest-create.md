## Kubernetesでの操作

K8sでは、Dockerのような簡単な手法では起動できません(ないわけではないが)。
K8sでは「マニフェスト」と呼ばれるファイル(YAML)を作成します。このファイルは計画みたいなもので、K8sに対して「こういう状態にしてください」という指示を出すものです。
受け取ったK8sクラスタは、このマニフェストに従うようにリソースを制御します。

### マニフェストの作成

実際にマニフェストを作成してみましょう。
ファイル名は`httpd.yml`とします。

```{literalinclude} ./src/httpd.yml
:name: httpd.yaml
:language: yaml
:linenos:
```

今のところ細かい内容は気にしなくても大丈夫です。

- httpd:2を用いたコンテナを起動する、内部名としてhttpdを割り当てる
- 起動したコンテナに対し、ラベル`app=httpd`を付与する
- K8s側ではラベル`app=httpd`を持つリソースを監視する
  - もし該当するラベルを持つコンテナが消滅したときは、再度起動する

### マニフェストの適用

作ったマニフェストを適用するために、`kubectl`コマンドを使います。作成したマニフェストファイルを引数に渡してください。

```{note}
マニフェストファイルのパスは、vscode上で行っているならエクスプローラー部分やファイル名のタブの所からターミナルに持ち込むことができますし、補完も適宜可能です。
```

```bash
$ kubectl apply -f httpd.yml
deployment.apps/httpd created
```

このマニフェストにより、"deployment.apps/httpd"というリソースが作成されました(というメッセージが表示されます)。

### 適用の確認

適用されたマニフェストにより、ノードに対しコンテナの生成を指示しています。
実際に作成作業が行われているかは、`kubectl`コマンドで確認できます。

```bash
$ kubectl get pods
NAME                     READY   STATUS    RESTARTS   AGE
httpd-6f8c7bfc4f-47rzj   1/1     Running   0          2s
```

ここでは、Pod(ポッド)リソースの状態取得を行いました。
READYの部分が『起動するべき数と起動している数』の分数になっています。1/1なので、1つのコンテナが起動している状態です。
STATUS部分はコンテナの生成状況などが出ています、`Running`なら正常に起動しています。

では、先程同様、ブラウザで確認してみましょう。

- http://127.0.0.1:8080/
- http://127.0.0.1/

表示されるでしょうか?
