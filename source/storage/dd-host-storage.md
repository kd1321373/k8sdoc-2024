# Docker Desktopにおけるストレージ

Docker Desktopで構築しているK8s環境においては、ストレージの扱いについていくつかの注意点があります。

- デフォルトで、ホストの`/Users`ディレクトリがマウントされています
  - これは、K8sのノードがDocker DesktopのVM上に作成されるためです
  - そのため、ホストの`/Users`ディレクトリ以下にあるファイルは、K8sのノードからアクセス可能です

このため、ホストの`/Users`ディレクトリ以下にファイルを配置することで、K8sのノードからアクセス可能なストレージを作成することができます。

## ノード上のストレージ利用

先程の例では、`volumes[0]`にて`persistentVolumeClaim`を指定しましたが、これ以外の選択肢として、ノード上のストレージを利用することもできます。

二つの選択肢があります。

- emptyDir
  - 空っぽのディレクトリをノード側で適当に作成して割り当ててくれます
  - Pod削除時に自動的に削除されます、テンポラリみたいな感じになります
- hostpath
  - ホストのディレクトリを指定して割り当ててくれます
  - ホストのディレクトリが削除されると、Podが利用できなくなります

ということで、`hostPath`を使って動きを確認してみます。
`pod-sample.yml`を`pod-sample-hostpath.yml`としてコピーし、以下のように変更します。

```{literalinclude} src/pod-sample-hostpath.yml
:language: yaml
:diff: src/pod-sample.yml
```

書き替えた[コード](src/pod-sample-hostpath.yml)の重要なポイントを確認してみましょう。

- `volumes[0]`にて`hostPath`を指定しています
  - `path`にてホストのディレクトリを指定します
  - `type`にてディレクトリかファイルかを指定します

このように設定したボリュームを、`volumeMounts`でマウントさせることにより、「Pod→ノード→ホスト」という経路でアクセスができるようになっています。

```{note}
なお、今回はホスト側のファイルを壊さないために、読み込み専用フラグ(`readOnly: true`)を指定しています。
設定しないと書き込みが可能になりますが、アクセス権的に許されるかは別の問題です。環境による差違が出ることがあるので、興味ある方は試してみてください。
ただし実際にファイルを壊さないよう、細心の注意を払って操作しましょう。
```
