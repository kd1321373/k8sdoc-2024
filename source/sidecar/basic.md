# 基本のサイドカーパターン

サイドカーパターンは、本来のコンテナ(サービスを提供するアプリケーション)の脇で動いているコンテナです。以前も出したような構成(MySQL+phpMyAdmin)が実は該当しています。

サイドカーパターンと呼ばれるものでは、本来のコンテナの挙動に影響を与えることなく、補助的な機能を提供するコンテナを指します。例えば、ログの収集や監視、設定ファイルの提供などが挙げられます。

実際の例で考えてみましょう。

- 本来のコンテナ: Webサーバー
- サイドカーコンテナ: ログ収集エージェント

この場合、Webサーバーはログを出力するだけで、ログの収集はサイドカーコンテナが行います。このように、本来のコンテナの挙動に影響を与えずに、補助的な機能を提供することができます。

```{literalinclude} src/web+logger.yml
:language: yaml
:linenos:
:emphasize-lines: 28-34,38-40
```

上記のリソース deployment/web-logger では、サイドカーパターンとして2つのコンテナが動いています。
nginxで動いているWebサーバーは、ログを出力しているだけですが、ログの出力先をボリュームとして共有することで、サイドカーとして動いているloggerコンテナでもそのログを見ることができます(ついでに何やら書き込んでいますが)。

つまり、本来の動作に影響を与えずに、補助的な機能を提供できることがわかると思います。
例えば一定期間ごとにログをアーカイブして外部に送信してリセットをかけるといったことも可能でしょう。

````{note}
今回のケースで使っている少し特殊なボリュームがあります。

```{literalinclude} src/web+logger.yml
:language: yaml
:lines: 38-40
```

このボリュームは、ノード上の適当な場所で『中身が空っぽのディレクトリ』を提供する仕組みです。
ポッドが有効な間は使い回されますが、ポッドが削除されると中身が空っぽになります。
容量の上限はノードの状態によるため、極端に大きなサイズは規定できませので、注意してください。

````
